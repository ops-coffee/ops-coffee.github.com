<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="Devops,运维,运维博客,运维开发,自动化,云计算,ops,sre,linux,devops,cloud" />
  <meta name="description" content="我们自研的那些Devops工具" />
  <link rel="stylesheet" href="https://blz.nosdn.127.net/sre/posts/css/style.min.css" type="text/css" />
  <link rel="shortcut icon" href="https://blz.nosdn.127.net/sre/images/favicon.ico" />

  <!-- Begin SEO tag -->
  <title>我们自研的那些Devops工具</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="运维咖啡吧" />
  <meta property="og:url" content="https://ops-coffee.cn/" />
  <meta property="og:title" content="我们自研的那些Devops工具" />
  <meta property="og:description" content="我们自研的那些Devops工具" />
  <link rel="canonical" href="https://ops-coffee.cn/" />
  <!-- End SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145167079-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-145167079-1');
  </script>

  <!-- Google Adsense -->
  <script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>
  <header class="header">
    <div class="inner">
      <a href="https://ops-coffee.cn/">
        <h1>运维咖啡吧</h1>
      </a>
      <h2>追求技术的道路上，我从不曾停下脚步</h2>
    </div>

	  <div class="mobile">
      <a class="site" href="/">运维咖啡吧</a>
      <nav class="header-menu">
        <ul>
          <li class=""><a href="javascript:void(0);" id="showMenu">MENU</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div id="content-wrapper">
    <div class="inner clearfix">
      <section id="main-content">
        
        <h1 id="art-title">我们自研的那些Devops工具</h1>
        

        <blockquote>
<p>随着云技术以及容器技术的崛起，人肉运维的时代结束了</p>
</blockquote>
<p>2018年为了解决日常运维中的痛点以及更高效的推进运维工作，我们自研并完善了几个工具系统，这些系统无一例外的帮我们节约了时间，提高了效率，这篇文章将分享介绍一下这些工具系统</p>
<h1 id="_1">系统介绍</h1>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.devops.png" /></p>
<h2 id="cmdb">CMDB</h2>
<p>CMDB配置管理数据库，主要用来记录我们管理维护的软硬件信息，包含实体的服务器，交换机以及虚拟的项目、服务、环境等所有需要管理维护的信息，通俗一点理解就是之前我们可能一个excel表格记录了我们维护的所有项目，项目所用的服务器资源，服务器的配置等等信息，都可以录入到CMDB系统里统一维护管理</p>
<p>CMDB系统是其他很多系统的基石，要给所有用到基础信息的第三方系统提供API以查询或修改数据，例如提供项目对应的服务器信息给持续部署工具推送代码到项目服务器上，所以CMDB系统的数据准确性非常重要，同时只在一个地方维护基础信息能够让整个运维系统更可控，更高效，减少出错</p>
<p>我们CMDB系统上线时间比较久，之前仅是用来替代Excel表格维护信息用，今年为他增加了API，提供给第三方系统获取基础数据，API认证采用了JWT，关于API认证这篇文章有更多的介绍：<a href="https://ops-coffee.cn/s/Kgj_5ydnT2W4Gt0vrw7gtw">Django+JWT实现Token认证</a></p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.cmdb.png" /></p>
<h2 id="varian">varian</h2>
<p>varian是我们内部开发的一个模块化的持续集成工具，主要负责项目从源代码到最终可部署程序的这个过程，现在有大部分项目已经是Docker部署了，那么varian会负责从源代码到最终打包好的项目镜像并上传到镜像仓库这个过程，其中会涉及到编译、合并、压缩等等操作，这篇文章有详细介绍我们varian的工作过程：<a href="https://ops-coffee.cn/s/eM7SNKmtw2tDQtXBsBXyxQ">探秘varian：优雅的发布部署程序</a></p>
<p>varian的核心逻辑是把持续集成中的每一个小步骤拆分成独立的类或方法，最终根据项目类型的不同组装不同的类或方法，实现不同类型不同技术栈项目能够共用同一套持续集成程序，减少代码冗余，提高可用性</p>
<h2 id="nova">nova</h2>
<p>nova持续部署，配合varian做整个上线流程，nova主要负责的是将最终的可部署程序或者Docker镜像推送到线上各个节点更新的过程，因为线上环境比较复杂，有云主机、Docker容器、私有云、公有云k8s等，所以在nova这一层做了兼容</p>
<p>nova只接受三个参数，1.项目名称，2.部署环境，3.部署版本号，根据项目名称和部署环境调用CMDB提供的API确定最终推送项目到哪些节点，根据版本号去拉取代码仓库代码或者镜像仓库镜像</p>
<p>扩容、回滚、重启等操作都可以通过nova系统自动完成，这篇文章介绍了持续部署的更多细节：<a href="https://ops-coffee.cn/s/xnBehfSlZ3J02xb0GFuGDw">Docker环境的持续部署优化实践</a></p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.nova.png" /></p>
<h2 id="kerrigan">kerrigan</h2>
<p>在整个发布上线的过程中除了代码的变更之外，通常还会涉及到配置文件、数据库的变更，为了解决配置文件自动更新的问题我们开发了kerrigan系统，这篇文章有关于配置中心实现细节的介绍：<a href="https://ops-coffee.cn/s/uGUvV4jl4YIvNztuepdC8A">中小团队落地配置中心详解</a></p>
<p>kerrigan底层基于etcd+confd实现，主要实现在web端修改，服务器上自动更新生效的功能，kerrigan还能够管理多环境不同类型的配置，尤其擅长文件型的配置（区别于通常看到的基于KV的配置中心，对运维更友好），例如管理nginx，tomcat等配置，同时能够记录配置文件的修改历史，快速回滚配置，还支持配置文件对比，只修改保存延后发布等功能</p>
<p>因为我们项目比较多，每个项目的nginx里边有一堆的规则，基于Docker的话每个rewrite的更新都需要重新打包发布比较繁琐，使用kerrigan之后有效解决了这个问题</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.kerrigan.png" /></p>
<h2 id="overmind">overmind</h2>
<p>数据库运维系统overmind，除了能够解决发布上线过程中的最后一环数据库变更外，我们还集成了其他一些实用的功能，例如SQL审核、SQL查询、自动导数据的工单系统，密码表等</p>
<p>overmind的第一个版本主要是集成了inception做SQL的审核和执行，帮助我们自动化的处理线上数据库的变更，这篇文章有介绍：<a href="https://ops-coffee.cn/s/ZrrLUNRlAXVfVKvA1m0nsg">中小团队快速构建SQL自动审核系统</a></p>
<p>完成第一个版本之后内部推动开发测试使用，收集到反馈，在第一个版本的基础上添加了SQL查询、Explain执行计划展示等功能，后续发现DBA经常接到各个不通环境之间导数据的需求，又开发了工单功能来实现数据自动迁移，这篇文章有介绍迁移：<a href="https://ops-coffee.cn/s/6ztLq8Q591KnlQY33-YFdQ">运维效率之数据迁移自动化</a></p>
<p>后边抛弃了Excel维护密码的方式，开发了密码表功能，见这篇文章介绍：<a href="https://ops-coffee.cn/s/L6Jud6gp5c9bbaUljUkNFA">Django开发密码管理表实例【附源码】</a></p>
<p>overmind在慢慢完善，后续还会基于需求和实用性添加更多的功能来提高效率</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.overmind.png" /></p>
<h2 id="proxy">proxy</h2>
<p>proxy是一个代理系统，类似于阿里云的SLB，kubernetes的ingress，主要给开发测试环境使用</p>
<p>我们维护项目较多，每个项目有多套不同的环境，每个环境都有不同的域名，对应不同的后端服务，为了模拟真实请求过SLB代理的环境以及集中的管理这些项目入口，之前的做法是把所有的域名都指向到一个nginx服务器，nginx服务器通过基于域名的vhost代理到后端服务，每次添加或修改都通过手动变更nginx配置文件来完成，现在开发了proxy系统，可以通过页面来快速方便的完成</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.proxy.png" /></p>
<h2 id="wiki">wiki</h2>
<p>wiki系统在18年之前已上线，当年提出来规范化、文档化、自动化、智能化的运维目标，文档是整个运维过程中非常重要的一环，其好处不用多说，持续推进文档的输出也是我们非常重要的一环</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20190130.wiki.png" /></p>
<p>当然除了以上这些系统外还开发了一些小工具来规范管理，提高效率，这里不多介绍。另外我们还用到了大量的开源软件系统，例如Jenkins、ELK套件、Kubernetes等</p>
<h1 id="2019">2019年计划</h1>
<p>我们知道devops是从研发到上线整个过程自动化的一种思想，并不是某个工具或者某几个工具的集合，我一直在想如何才能将devops落到实处，18年基于当前的环境我们开发了以上的各种工具来帮助我们高效的工作，但这些工具系统相对分散，不能形成体系流程，19年会实践一些方式方法将这些工具系统串联，实现更高程度的自动化，同时也会持续推进Kubernetes更大范围的落地，为真正的实现Devops思想，从开发到上线的全流程自动化打基础</p>
<hr />
<p><img alt="扫码关注公众号查看更多实用文章" src="https://blz.nosdn.127.net/sre/wx.qrcode.jpg" /></p>
<p>如果你觉得读的不尽兴，推荐阅读以下文章：</p>
<ul>
<li><a href="https://ops-coffee.cn/s/GATfwNETo_aGsJHZdV5YzQ">中小团队基于Docker的devops实践</a></li>
<li><a href="https://ops-coffee.cn/s/dpGqieL4WCmGdQh1AEG4Gw">代码中的敏感信息加密方案</a></li>
</ul>
      </section>

      <aside id="sidebar">
        <button onclick="javascrtpt:window.open('/search.html')" style="width:100%;cursor:pointer">站内搜索</button>

<blockquote class="route">作者介绍</blockquote>
<p>37丫37，阿里云操作员，代码搬运工，涉猎广泛，重原则，有态度</p>
<p>运营公众号【运维咖啡吧】，这是一个不落俗套坚持初心的公众号，一个你不可错过的公众号</p>
<img border="0" src="https://blz.nosdn.127.net/sre/images/z-qrcode.jpg" width="100%" height="100%" alt="ops-coffee">
<p>欢迎关注，后台回复“小二”加我微信，聊技术，谈理想，悟人生</p>

<blockquote class="route">归档列表</blockquote>
<a class="button" href="/s" target="_blank"> 精选文章列表</a>
<a class="button" href="/t/" target="_blank"> 日常运维记录</a>
<a class="button" href="/devops" target="_blank"> 运维系统平台</a>
<a class="button" href="/webssh" target="_blank"> WebSSH系列</a>
<a class="button" href="/x" target="_blank"> 脑洞大开系列</a>
<a class="button" href="/w" target="_blank"> 新型冠状病毒</a>

<blockquote class="route">锟斤拷锟斤</blockquote>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- sidebar -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8944257246828217"
     data-ad-slot="1313935804"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      </aside>
    </div>
  </div>

  <footer class="footer">
    <div class="inner">
      <div class="copy"> © 2019 ops-coffee</div>

      <div class="link">
        <a href="#sidebar" onclick="if(confirm('扫描二维码，关注我吧')==false)return false;" title="关于本站" target="">关于本站</a>
        <a href="/friends" title="友情链接" target="_blank">友情链接</a>
      </div>
    </div>
  </footer>
</body>

<script>
  document.getElementById("showMenu").onclick=function(){
      if (document.getElementById("showMenu").innerText == 'MENU') {
      document.getElementById("showMenu").innerText = 'BACK';
      document.getElementById('sidebar').style.display="block";
      document.getElementById('main-content').style.display="none";
    } else {
      document.getElementById("showMenu").innerText = 'MENU';
      document.getElementById('sidebar').style.display="none";
      document.getElementById('main-content').style.display="block";
    }
  }
</script>
</html>