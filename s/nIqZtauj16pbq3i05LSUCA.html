<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="bpmn,js,bpmn,js,运维,运维博客,运维开发,自动化,云计算,ops,sre,linux,devops,cloud" />
  <meta name="description" content="最好用的流程编辑器bpmn-js系列之基本使用" />
  <link rel="stylesheet" href="https://blz.nosdn.127.net/sre/posts/css/ops-coffee.min.css" type="text/css" />
  <link rel="shortcut icon" href="https://blz.nosdn.127.net/sre/images/favicon.ico" />

  <!-- Begin SEO tag -->
  <title>最好用的流程编辑器bpmn-js系列之基本使用</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="运维咖啡吧" />
  <meta property="og:url" content="https://blog.ops-coffee.cn/" />
  <meta property="og:title" content="最好用的流程编辑器bpmn-js系列之基本使用" />
  <meta property="og:description" content="最好用的流程编辑器bpmn-js系列之基本使用" />
  <link rel="canonical" href="https://blog.ops-coffee.cn/" />
  <!-- End SEO tag -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145167079-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-145167079-1');
  </script>

  <!-- Google Adsense -->
  <script data-ad-client="ca-pub-8944257246828217" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>
  <header>
    <div class="container">
      <a href="https://blog.ops-coffee.cn/">
        <h1>运维咖啡吧</h1>
      </a>
      <h2>追求技术的道路上，我从不曾停下脚步</h2>
    </div>

    <div class="header-mobile">
      <a id="mobile-nav-site" href="/">运维咖啡吧</a>
      <a id="mobile-nav-menu" href="javascript:void(0);" >MENU</a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container clearfix">
      <section id="main-content">
        
        <h1 id="art-title">最好用的流程编辑器bpmn-js系列之基本使用</h1>
        

        <blockquote>
<p>最好用的流程编辑器bpmn-js系列文章</p>
</blockquote>
<p>BPMN（Business Process Modeling Notation）是由业务流程管理倡议组织BPMI（The Business Process Management Initiative）开发的一套<strong>标准</strong>的业务流程建模符号规范。其目的是为用户提供一套容易理解的标准符号，这些符号作为BPMN的基础元素，将业务流程建模简单化、图形化，将复杂的建模过程视觉化，让业务建模者、业务实施人员、管理监督人员对BPMN描述的业务流程都有一个更加清晰明了的了解。</p>
<p>BPMN的主要意义在于其作为一个标准，业务相关者都按照这个标准来绘制业务流程图，能够减少各方对于流程图的理解歧义，从而达到高效协作的目的</p>
<p>BPMN包含以下四类基本元素</p>
<ul>
<li>流对象（Flow Objects）：包括事件、活动、网关，是BPMN中的核心元素</li>
<li>连接对象（Connecting Objects）：包括顺序流、消息流、关联</li>
<li>泳道（Swimlanes）：包括池和道两种类型</li>
<li>人工信息（Artifacts）：包括数据对象、组、注释</li>
</ul>
<p>bpmn-js就是基于BPMN标准实现的一套渲染工具包和web建模器，以下系列文章将会介绍我的使用过程</p>
<h2 id="_1">基本使用</h2>
<p>bpmn-js的使用非常简单，我们可以在VUE项目中使用，或者是直接在HTML文件中引入JS/CSS资源文件，就像下边这样</p>
<pre class="codehilite"><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;zh-CN&quot;&gt;

&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, user-scalable=no&quot;/&gt;
  &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt;
  &lt;title&gt;运维咖啡吧 - BPMNJS&lt;/title&gt;

  &lt;!-- 引入BPMN-JS的CSS文件 --&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/bpmn-js@7.3.0/dist/assets/diagram-js.css&quot; /&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/bpmn-js@7.3.0/dist/assets/bpmn-font/css/bpmn.css&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div id=&quot;canvas&quot; style=&quot;height:80vh;&quot;&gt;&lt;/div&gt;

  &lt;!-- 引入BPMN-JS的JS文件 --&gt;
  &lt;script src=&quot;https://unpkg.com/bpmn-js@7.3.0/dist/bpmn-modeler.development.js&quot;&gt;&lt;/script&gt;
  &lt;script&gt;
    var diagramXML = `&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;bpmn2:definitions xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:bpmn2=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot; xmlns:bpmndi=&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot; xmlns:dc=&quot;http://www.omg.org/spec/DD/20100524/DC&quot; id=&quot;sample-diagram&quot; targetNamespace=&quot;http://bpmn.io/schema/bpmn&quot; xsi:schemaLocation=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd&quot;&gt;
&lt;bpmn2:process id=&quot;Process_1&quot; isExecutable=&quot;false&quot;&gt;
  &lt;bpmn2:startEvent id=&quot;StartEvent_1&quot; /&gt;
&lt;/bpmn2:process&gt;
&lt;bpmndi:BPMNDiagram id=&quot;BPMNDiagram_1&quot;&gt;
  &lt;bpmndi:BPMNPlane id=&quot;BPMNPlane_1&quot; bpmnElement=&quot;Process_1&quot;&gt;
    &lt;bpmndi:BPMNShape id=&quot;_BPMNShape_StartEvent_2&quot; bpmnElement=&quot;StartEvent_1&quot;&gt;
      &lt;dc:Bounds x=&quot;192&quot; y=&quot;82&quot; width=&quot;36&quot; height=&quot;36&quot; /&gt;
    &lt;/bpmndi:BPMNShape&gt;
  &lt;/bpmndi:BPMNPlane&gt;
&lt;/bpmndi:BPMNDiagram&gt;
&lt;/bpmn2:definitions&gt;`

    var bpmnModeler = new BpmnJS({
      container: '#canvas'
    });

    bpmnModeler.importXML(diagramXML, function(err) {
      if (err) {
        return console.error('failed to load diagram', err);
      }
    });
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>


<p>浏览器访问会出现如下一个流程编辑器，可以在这里进行流程的编辑</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20200908.01.png" /></p>
<p>bpmn-js有两种模式：Modeler模式和Viewer模式，在Modeler模式下可以对流程图进行编辑，而Viewer模式则不能，仅作为展示用</p>
<p>viewer模式相对简单，无需引入CSS文件，只需引入一个JS即可</p>
<pre class="codehilite"><code>&lt;script src=&quot;https://unpkg.com/bpmn-js@7.3.0/dist/bpmn-viewer.development.js&quot;&gt;&lt;/script&gt;</code></pre>


<p>通常在流程执行阶段的展示用Viewer模式，配合节点颜色设置让用户清晰的看到当前流程的执行过程和状态</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20200908.02.png" /></p>
<h2 id="vue">VUE中使用</h2>
<p>更多的时候我们可能会在VUE项目中使用，为了展示清晰，这里先通过vue-cli脚手架创建一个vue项目</p>
<pre class="codehilite"><code>vue create ops-coffee-bpmn
cd ops-coffee-bpmn</code></pre>


<p>原始的目录结构大概是这个样子的</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20200908.03.png" /></p>
<p>安装bpmn-js</p>
<pre class="codehilite"><code>npm install bpmn-js --save</code></pre>


<p>安装完成后就可以开始使用bpmn-js了，首先要引入bpmn-js的CSS，修改<code>src/main.js</code>文件</p>
<pre class="codehilite"><code>import Vue from &quot;vue&quot;;
import App from &quot;./App.vue&quot;;
import router from &quot;./router&quot;;
import store from &quot;./store&quot;;

Vue.config.productionTip = false;

import &quot;bpmn-js/dist/assets/diagram-js.css&quot;;
import &quot;bpmn-js/dist/assets/bpmn-font/css/bpmn.css&quot;;
import &quot;bpmn-js/dist/assets/bpmn-font/css/bpmn-codes.css&quot;;
import &quot;bpmn-js/dist/assets/bpmn-font/css/bpmn-embedded.css&quot;;

new Vue({
  router,
  store,
  render: h =&gt; h(App)
}).$mount(&quot;#app&quot;);</code></pre>


<p>然后编写<code>bpmn-modeler.vue</code>文件，文件位于<code>src/views/bpmn-modeler.vue</code></p>
<pre class="codehilite"><code>&lt;template&gt;
  &lt;div class=&quot;containers&quot;&gt;
    &lt;div class=&quot;canvas&quot; ref=&quot;canvas&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import BpmnModeler from &quot;bpmn-js/lib/Modeler&quot;;
import { xmlStr } from &quot;../mock/xmlStr&quot;;

export default {
  name: &quot;ops-coffee&quot;,
  mounted() {
    this.init();
  },
  data() {
    return {
      bpmnModeler: null,
      container: null,
      canvas: null
    };
  },
  methods: {
    init() {
      const canvas = this.$refs.canvas;
      this.bpmnModeler = new BpmnModeler({
        container: canvas
      });

      this.createNewDiagram();
    },
    createNewDiagram() {
      try {
        const result = this.bpmnModeler.importXML(xmlStr);
        const { warnings } = result;
        console.log(warnings);
      } catch (err) {
        console.log(err.message, err.warnings);
      }
    }
  }
};
&lt;/script&gt;

&lt;style scoped&gt;
.containers {
  width: 100%;
  height: calc(100vh - 82px);
}
.canvas {
  width: 100%;
  height: 100%;
}
&lt;/style&gt;</code></pre>


<p>这里引入了一个外部变量<code>xmlStr</code>，这个变量主要用来存放BPMN的XML数据，这里创建对应的<code>src/mock/xmlStr.js</code>文件</p>
<pre class="codehilite"><code>export var xmlStr = `&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;bpmn2:definitions xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:bpmn2=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot; xmlns:bpmndi=&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot; xmlns:dc=&quot;http://www.omg.org/spec/DD/20100524/DC&quot; id=&quot;sample-diagram&quot; targetNamespace=&quot;http://bpmn.io/schema/bpmn&quot; xsi:schemaLocation=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd&quot;&gt;
&lt;bpmn2:process id=&quot;Process_1&quot; isExecutable=&quot;false&quot;&gt;
  &lt;bpmn2:startEvent id=&quot;StartEvent_1&quot; /&gt;
&lt;/bpmn2:process&gt;
&lt;bpmndi:BPMNDiagram id=&quot;BPMNDiagram_1&quot;&gt;
  &lt;bpmndi:BPMNPlane id=&quot;BPMNPlane_1&quot; bpmnElement=&quot;Process_1&quot;&gt;
    &lt;bpmndi:BPMNShape id=&quot;_BPMNShape_StartEvent_2&quot; bpmnElement=&quot;StartEvent_1&quot;&gt;
      &lt;dc:Bounds x=&quot;192&quot; y=&quot;82&quot; width=&quot;36&quot; height=&quot;36&quot; /&gt;
    &lt;/bpmndi:BPMNShape&gt;
  &lt;/bpmndi:BPMNPlane&gt;
&lt;/bpmndi:BPMNDiagram&gt;
&lt;/bpmn2:definitions&gt;`;</code></pre>


<p>最后修改<code>src/router/index.js</code>文件添加路由</p>
<pre class="codehilite"><code>const routes = [
  {
    path: &quot;/&quot;,
    name: &quot;编辑模式&quot;,
    component: () =&gt; import(&quot;../views/bpmn-modeler.vue&quot;)
  },
];</code></pre>


<p>然后访问页面，就可看到流程编辑器，进行流程编辑等操作</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20200908.04.png" /></p>
<p>以上为Modeler模式，如果想用Viewer模式的话，也非常简单，仅需将引入的<code>Modeler</code>改为<code>Viewer</code>即可</p>
<pre class="codehilite"><code>import BpmnViewer from &quot;bpmn-js/lib/Viewer&quot;;</code></pre>


<h2 id="_2">概念名词</h2>
<p>在使用bpmn-js的过程中，经常会出现一些名词，了解他们有利于我们后续的使用和开发</p>
<p><img alt="" src="https://blz.nosdn.127.net/sre/images/20200908.05.png" /></p>
<p>画布中的元素叫element，element包含连线connection和形状shape，流程图是由shape和connection组成的，可以通过拖动左侧工具栏Palette来创建元素，点击元素会出现ContextPad工具箱，不同的元素会出现不同的ContextPad，可以通过ContextPad工具创建shape或connection，也可以修改元素type，添加注解，以及删除元素等操作</p>
<h2 id="_3">写在最后</h2>
<p>接触bpmn-js不久，且第一次用VUE，边学边写，文章难免出错，各位多多包含。想要打造一个好用的适合自己的流程编辑器，需要了解的内容比较多，bpmn-js会分多篇文章来介绍，这是本系列的第一篇，下一篇介绍bpmn-js的数据保存等内容，欢迎关注</p>
<p>部分小伙伴对流程编辑器不了解，或是对BPMN不了解，我搭建了个在线的Demo: <a href="https://bpmn.ops-coffee.cn">https://bpmn.ops-coffee.cn</a>，点击链接即可轻松体验，建议PC端打开效果更好</p>
      </section>

      <aside id="sidebar">
        <button onclick="javascrtpt:window.open('/search.html')" style="width:100%;cursor:pointer">站内搜索</button>

<blockquote class="route">作者介绍</blockquote>
<p>37丫37，阿里云操作员，代码搬运工，涉猎广泛，重原则，有态度</p>
<p>运营公众号【运维咖啡吧】，这是一个不落俗套坚持初心的公众号，一个你不可错过的公众号</p>
<img border="0" src="https://blz.nosdn.127.net/sre/images/z-qrcode.jpg" width="100%" height="100%" alt="ops-coffee">
<p>欢迎关注，后台回复“小二”加我微信，聊技术，谈理想，悟人生</p>

<blockquote class="route">归档列表</blockquote>
<a class="button" href="/devops" target="_blank"> 运维系统平台</a>
<a class="button" href="/webssh" target="_blank"> WebSSH系列</a>
<a class="button" href="/elk" target="_blank"> ELK日志系统</a>
<a class="button" href="/bpmn" target="_blank"> BPMN-JS系列</a>
<a class="button" href="/x/" target="_blank"> 脑洞大开系列</a>
<a class="button" href="/t/" target="_blank"> 日常运维记录</a>

<blockquote class="route">锟斤拷锟斤</blockquote>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- sidebar -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-8944257246828217"
     data-ad-slot="1313935804"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
      </aside>
    </div>
  </div>

  <footer class="footer">
    <div class="container clearfix">
      <div class="copy"> © 2020 ops-coffee</div>

      <div class="link">
        <a href="#sidebar" onclick="if(confirm('扫描二维码，关注我吧')==false)return false;" title="关于本站" target="">关于本站</a>
        <a href="/friends" title="友情链接" target="_blank">友情链接</a>
      </div>
    </div>
  </footer>
</body>

<script>
  document.getElementById("mobile-nav-menu").onclick = function () {
    if (document.getElementById("mobile-nav-menu").innerText == 'MENU') {
      document.getElementById("mobile-nav-menu").innerText = 'BACK';
      document.getElementById('sidebar').style.display = "block";
      document.getElementById('main-content').style.display = "none";
    } else {
      document.getElementById("mobile-nav-menu").innerText = 'MENU';
      document.getElementById('sidebar').style.display = "none";
      document.getElementById('main-content').style.display = "block";
    }
  }
</script>
</html>